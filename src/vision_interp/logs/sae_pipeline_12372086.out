==========================================
SAE Pipeline
Config: src/vision_interp/configs/TinierInceptionV1/sae_tinier_features1.yaml
Training only: false
==========================================
Activating virtual environment...

Step 1: Training SAE...
Using device: cuda.
Single training run configuration
Training configuration:
  sae_type: topk
  expansion_factor: 2
  l1_coeff: None
  topk: 4
  batch_size: 1024
  lr: 5e-3
  weight_decay: 1e-5
  epochs: 1

Loading activations from 13 files.

Loaded 51200000 activation vectors of size 40.

Training topk SAE on 40-dimensional activations.
SAE will have 80 latents.

Epoch 1/1:
  Total Loss: 0.069667, Reconstruction Loss: 0.069667, L1 Loss: 0.072690, L0 Norm: 4.0, R2: 0.660, Fraction Alive: 1.000
Saved SAE to src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/sae.pth

SAE trained and saved to: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk

Step 2: Saving SAE activations...
Loaded config from SAE directory: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk
Using device: cuda.
Loading activations from 13 files.
Loaded 51200000 model activations pre-SAE.
Loaded SAE model from src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/sae.pth
Processed batch 1 with input shape torch.Size([16384, 40]) and output shape torch.Size([16384, 80]).

Saved complete mapping to src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/sae_activations.pt. 51200000 activations saved.

Step 3: Generating feature activating examples...
Running in feature mode
Loaded config from: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/config.yaml
Using device: cuda.
Loaded 50000 images.
Loaded 51200000 samples for 80 SAE features.
Created cache for 1024 receptive fields.
Saved feature activation histogram to src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/feature_activation_histogram.png
Feature activation statistics:
  Mean activation count: 25389330.6
  Median activation count: 25419957.5
  Max activation count: 50700388.0
  Min activation count: 954827.0

Step 4: Generating neuron activating examples...
Running in neuron mode
Loaded config from: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/config.yaml
Using device: cuda.
Loaded 50000 images.
Loading activations from 13 files.
Loaded 51200000 samples for 40 model channels.
Created cache for 1024 receptive fields.
Saved neuron activation histogram to src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/neuron_activation_histogram.png
Neuron activation statistics:
  Mean activation count: 9733119.7
  Median activation count: 9592820.0
  Max activation count: 14672292.0
  Min activation count: 5901957.0

Step 5: Analyzing SAE feature branch preferences...
Analyzing SAE branches for: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk
Branch preference threshold: 0.5
Layer: features.1
SAE type: topk
Expansion factor: 2
TopK: 4
Saved feature clusters to: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk/feature_branch_clusters.csv

Branch Analysis Summary for features.1:
Total features: 80
Number of branches: 4

Features per branch:
  Branch 1: 18 features (22.5%)
  Branch 2: 28 features (35.0%)
  Branch 3: 19 features (23.8%)
  Branch 4: 15 features (18.8%)

Analysis completed successfully!

==========================================
Pipeline completed successfully!
Results in: src/vision_interp/models/TinierInceptionV1/tinier_features1_topk
==========================================
